# 软件安装文档

> ! 本文档记录本项目所需软件的安装过程。按照本文档安装软件之前，需要先初始化一次 [软件安装目录](#软件安装目录)

## 软件版本汇总

| 软件    | 版本      |
|:--------|:----------|
| Ubuntu  | 16.04 x64 |
| MySQL   | 5.7.21    |
| OpenJDK | 1.8       |
| Tomcat  | 8.5.23    |
| Maven   | 3.5.0     |
| Nginx   | 1.12.1    |
| vsftpd  | 3.0.3     |

## 软件安装目录

```bash
mkdir -p $HOME/packages     # 下载路径
mkdir -p $HOME/softwares    # 软件路径
mkdir -p $HOME/srccode      # 源码路径
```

## 安装 OpenJDK

```bash
sudo apt-get update -y && sudo apt-get install openjdk-8-jdk -y
```

## 安装 Tomcat

1. 下载和安装

   ```bash
   # 下载
   wget -c https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.23/bin/apache-tomcat-8.5.23.tar.gz -O $HOME/packages/apache-tomcat-8.5.23.tar.gz
   
   # 解压
   tar -zxvf $HOME/packages/apache-tomcat-8.5.23.tar.gz -C $HOME/softwares
   
   # 配置环境变量
   echo "export CATALINA_HOME=$HOME/softwares/apache-tomcat-8.5.23" >> $HOME/.bash_aliases
   echo "export PATH=\${CATALINA_HOME}/bin:\$PATH" >> $HOME/.bash_aliases
   
   # 重载环境变量
   source $HOME/.bash_aliases
   ```

2. 配置字符集

   ```bash
   # 在 配置文件 $CATALINA_HOME/conf/server.xml 的 8080 节点配置中追加内容： URIEncoding="UTF-8", 如下
   <Connector port="8080" ...... URIEncoding="UTF-8">
   ```

3. 启动：`startup.sh`

   *温馨提示*：如果 Tomcat 安装完成后启动时间太长，解决方法如下

   ```bash
   注释掉 $JAVA_HOME/jre/lib/security/java.security 中的 securerandom.source=file:/dev/random
   ```

4. [配置防火墙](#配置防火墙)，开放相关端口：`8080`
5. 验证：使用浏览器访问 `http://ip:8080`，如果出现 Tomcat 欢迎页面，则说明安装成功了

## 安装 Maven

```bash
# 下载
wget -c https://archive.apache.org/dist/maven/maven-3/3.5.0/binaries/apache-maven-3.5.0-bin.tar.gz -O $HOME/packages/apache-maven-3.5.0-bin.tar.gz

# 解压
tar -zxvf $HOME/packages/apache-maven-3.5.0-bin.tar.gz -C $HOME/softwares

# 配置环境变量
echo "export MAVEN_HOME=$HOME/softwares/apache-maven-3.5.0" >> $HOME/.bash_aliases
echo "export PATH=\${MAVEN_HOME}/bin:\$PATH" >> $HOME/.bash_aliases

# 重载环境变量
source $HOME/.bash_aliases

# 验证
mvn -v
```

## 安装 MySQL

1. 安装
   1.  安装 MySQL APT 配置软件

       ```bash
       wget https://repo.mysql.com/mysql-apt-config_0.8.7-1_all.deb
       sudo dpkg -i mysql-apt-config_0.8.7-1_all.deb
       ```
   2.  安装 MySQL

       ```bash
       sudo apt-get update -y && sudo apt-get install mysql-server -y --allow-unauthenticated
       ```
   3.  启动交互式安全配置 (可选)

       ```bash
       sudo mysql_secure_installation
       ```

2. 配置字符集

   ```bash
   在配置文件 /etc/mysql/conf.d/mysql.cnf 的 [mysql] 节点下添加 default-character-set=utf8
   在配置文件 /etc/mysql/mysql.conf.d/mysqld.cnf 的 [mysqld] 节点下添加 character-set-server=utf8
   ```

## 安装 Vsftpd

1. 安装

   ```bash
   sudo apt-get -y update && sudo apt-get install -y vsftpd
   ```

2. 配置：下载 / 复制 [自定义配置文件]，替换掉 vsftpd 的默认配置文件 `/etc/vsftpd.conf`
3. 重启

   ```bash
   sudo service vsftpd restart
   ```

4. [配置防火墙](#配置防火墙)，开放相关端口：`20、21、61000-62000`

## 安装 Nginx

1. 安装依赖

   ```bash
   sudo apt-get install -y gcc make openssl libssl-dev zlib1g-dev libpcre3 libpcre3-dev
   ```

2. 下载

   ```bash
   mkdir -p $HOME/packages && wget -c http://nginx.org/download/nginx-1.12.1.tar.gz -O $HOME/packages/nginx-1.12.1.tar.gz
   ```

3. 解压

   ```bash
   mkdir -p $HOME/srccode && tar -zxvf $HOME/packages/nginx-1.12.1.tar.gz -C $HOME/srccode
   ```

4. 进入解压目录并执行预编译

   ```bash
   cd $HOME/srccode/nginx-1.12.1 && ./configure
   ```
5. 编译 & 安装

   ```bash
   make && sudo make install
   ```

6. 配置环境变量

   ```bash
   echo "export NGINX_HOME=/usr/local/nginx" | sudo tee -a $HOME/.bash_aliases
   echo "alias nginx='sudo \$NGINX_HOME/sbin/nginx'" | sudo tee -a $HOME/.bash_aliases
   ```

7. 重载环境变量

   ```bash
   source $HOME/.bash_aliases
   ```

8. 验证和启动

   ```bash
   nginx -v && nginx
   ```

9. [配置防火墙](#配置防火墙)，开放相关端口：`HTTP: 80`、`HTTPS: 443`
10. 验证：使用浏览器访问 `http://ip`，如果出现 Nginx 欢迎页面，则说明安装成功了

## 配置防火墙

- 如果是本地机器，需要在操作系统层面配置防火墙
- 如果是云服务器，通常只需要在云服务器提供商提供的操作界面上配置安全组等类似防火墙的规则

[自定义配置文件]: https://raw.githubusercontent.com/epochwz/shell/master/src/vsftpd/vsftpd.conf
