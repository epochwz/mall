# 数据库设计

通过前面的需求分析和接口设计，我们已经清楚了项目所产生的数据以及数据之间的联系，并建立了相应的数据模型。因此数据库设计阶段，只需要选择适当的数据类型、必要的条件约束来建立相应的数据表即可。

## 基础设计

本项目在进行数据库设计的时候，遵循以下原则

- 索引相关
  - 需要频繁查询的字段，使用单索引、组合索引来提高查询效率
  - 对具备唯一性的字段，使用唯一索引来保证数据的唯一性
  - 允许适当增加冗余字段，减少联表查询，从而提高查询效率
- 记录相关
  - 所有记录都使用自增长主键
  - 所有记录都具备两个时间戳：创建时间 和 更新时间
    - 时间戳可以作为查询业务问题时的后悔药：在应用程序缺失日志记录的时候，还能由记录的时间戳信息推测事件发生的时间范围，提高问题处理的效率
    - 时间戳可以用于查询指定时间范围内的数据，从而进行业务数据的分析
  - 所有表示价格的字段，由于涉及商业计算中浮点数丢失精度的问题，一律使用 `DECIMAL` 数据类型，对应 Java 中的 `BigDecimal` 类型，单位是元，保留两位小数
- 其他
  - 一律不使用外键和触发器，否则在后续进行分库分表、数据清洗的时候会比较麻烦。

## 表结构

本系统所有的数据表都必须包含下面几个字段，且应用程序不干预这些字段值的插入和更新，而是由数据库在插入和更新记录时自动更新这些字段

| 字段名称     | 数据类型  | 字段含义       | 非空 | 唯一 | 默认值                | 备注                              |
|:------------|:---------|:--------------|:-----|:----|:----------------------|:----------------------------------|
| id          | INT(11)  | 记录的唯一标识 | 是   | 是  | 自增长                | 主键                              |
| create_time | DATETIME | 记录的创建时间 | 是   | 否  | 记录的创建时间         | 仅在记录创建时插入一次，之后不再更新 |
| update_time | DATETIME | 记录的更新时间 | 是   | 否  | 记录的最后一次更新时间 | 每次更新记录时都进行更新            |

### 用户表

用户表 `user` 用于存放注册用户的信息

| 字段名称  | 数据类型      | 字段含义 | 非空 | 唯一 | 默认值 | 备注                 |
|:---------|:-------------|:--------|:-----|:-----|:------|:---------------------|
| username | VARCHAR(50)  | 用户名  | 是   | 是   | 无    |                      |
| password | VARCHAR(50)  | 账号密码 | 是   | 否   | 无    | MD5 盐值加密         |
| email    | VARCHAR(50)  | 电子邮箱 | 否   | 是   | 无    |                      |
| mobile   | VARCHAR(20)  | 手机号码 | 否   | 是   | 无    |                      |
| question | VARCHAR(100) | 密保问题 | 否   | 否   | 无    |                      |
| answer   | VARCHAR(100) | 密保答案 | 否   | 否   | 无    |                      |
| role     | TINYINT      | 用户角色 | 是   | 否   | 1     | 0-管理员 / 1-普通用户 |

### 收货地址表

收货地址表 `shipping` 用于存放用户的收货地址信息

| 字段名称  | 数据类型      | 字段含义      | 非空 | 唯一 | 默认值 | 备注   |
|:---------|:-------------|:-------------|:-----|:-----|:------|:-------|
| user_id  | INT(11)      | 所属用户的 ID | 是   | 否   | 无    | 单索引 |
| name     | VARCHAR(20)  | 收货人姓名    | 是   | 否   | 无    |        |
| mobile   | VARCHAR(20)  | 手机         | 是   | 否   | 无    |        |
| province | VARCHAR(20)  | 省份         | 是   | 否   | 无    |        |
| city     | VARCHAR(20)  | 城市         | 是   | 否   | 无    |        |
| district | VARCHAR(20)  | 区 / 县      | 是   | 否   | 无    |        |
| address  | VARCHAR(200) | 详细地址      | 是   | 否   | 无    |        |
| zip      | VARCHAR(6)   | 邮编         | 否   | 否   | 无    |        |
